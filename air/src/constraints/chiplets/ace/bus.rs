use miden_core::field::PrimeCharacteristicRing;
use miden_crypto::stark::air::MidenAirBuilder;

use crate::trace::MainTraceRow;

pub fn enforce_ace_wiring_bus_constraints<AB>(builder: &mut AB, alpha: AB::RandomVar, beta_challenges: &[AB::RandomVar], aux_current: &[AB::VarEF], aux_next: &[AB::VarEF], local: &MainTraceRow<AB::Var>, next: &MainTraceRow<AB::Var>)
where
    AB: MidenAirBuilder,
{
    builder.when_transition().assert_zero_ext((alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[16].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[17].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[18].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * AB::ExprEF::from(aux_current[7].clone().into()) + (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[16].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[17].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[18].clone().into()) * beta_challenges[4].into()) * AB::ExprEF::from(local.chiplets[0].clone().into()) * AB::ExprEF::from(local.chiplets[1].clone().into()) * AB::ExprEF::from(local.chiplets[2].clone().into()) * (AB::ExprEF::ONE - AB::ExprEF::from(local.chiplets[3].clone().into())) * AB::ExprEF::from(local.chiplets[19].clone().into()) * (AB::ExprEF::ONE - AB::ExprEF::from(local.chiplets[5].clone().into())) + (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[16].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[17].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[18].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * AB::ExprEF::from(local.chiplets[0].clone().into()) * AB::ExprEF::from(local.chiplets[1].clone().into()) * AB::ExprEF::from(local.chiplets[2].clone().into()) * (AB::ExprEF::ONE - AB::ExprEF::from(local.chiplets[3].clone().into())) * AB::ExprEF::from(local.chiplets[18].clone().into()) * (AB::ExprEF::ONE - AB::ExprEF::from(local.chiplets[5].clone().into())) + (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[16].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[17].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[18].clone().into()) * beta_challenges[4].into()) * AB::ExprEF::from(local.chiplets[0].clone().into()) * AB::ExprEF::from(local.chiplets[1].clone().into()) * AB::ExprEF::from(local.chiplets[2].clone().into()) * (AB::ExprEF::ONE - AB::ExprEF::from(local.chiplets[3].clone().into())) * AB::ExprEF::from(local.chiplets[19].clone().into()) * AB::ExprEF::from(local.chiplets[5].clone().into()) - ((alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[16].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[17].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[18].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * AB::ExprEF::from(aux_next[7].clone().into()) + (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[16].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[17].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[18].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * AB::ExprEF::from(local.chiplets[0].clone().into()) * AB::ExprEF::from(local.chiplets[1].clone().into()) * AB::ExprEF::from(local.chiplets[2].clone().into()) * (AB::ExprEF::ONE - AB::ExprEF::from(local.chiplets[3].clone().into())) * AB::ExprEF::from(local.chiplets[5].clone().into()) + (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[13].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[14].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[15].clone().into()) * beta_challenges[4].into()) * (alpha.into() + AB::ExprEF::from(local.chiplets[8].clone().into()) * beta_challenges[0].into() + AB::ExprEF::from(local.chiplets[6].clone().into()) * beta_challenges[1].into() + AB::ExprEF::from(local.chiplets[10].clone().into()) * beta_challenges[2].into() + AB::ExprEF::from(local.chiplets[11].clone().into()) * beta_challenges[3].into() + AB::ExprEF::from(local.chiplets[12].clone().into()) * beta_challenges[4].into()) * AB::ExprEF::from(local.chiplets[0].clone().into()) * AB::ExprEF::from(local.chiplets[1].clone().into()) * AB::ExprEF::from(local.chiplets[2].clone().into()) * (AB::ExprEF::ONE - AB::ExprEF::from(local.chiplets[3].clone().into())) * AB::ExprEF::from(local.chiplets[5].clone().into())));
}
